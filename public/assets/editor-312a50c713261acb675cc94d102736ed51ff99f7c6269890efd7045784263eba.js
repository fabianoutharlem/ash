var editor=function(){function t(){if($("#zenpenbubble").length){lastRange=0,i();var t=document.createRange(),n=window.getSelection();n.removeAllRanges(),n.addRange(t),e()}}function e(){document.onkeyup=n,document.onmousedown=n,document.onmouseup=function(t){setTimeout(function(){n(t)},1)},window.addEventListener("resize",function(){r()});var t=!0;document.body.addEventListener("scroll",function(){return t?(t=!0,r(),setTimeout(function(){t=!0},250)):void 0})}function i(){m=document.querySelector(".content"),b=document.querySelector(".text-options"),y=b.querySelector(".options"),x=b.querySelector(".bold"),x.onclick=c,B=b.querySelector(".italic"),B.onclick=u,C=b.querySelector(".url"),C.onmousedown=A,_=b.querySelector(".url-input"),_.onblur=f,_.onkeydown=d}function n(t){var e=window.getSelection();return"url-input"===t.target.className||"undefined"!=typeof t.target.classList&&t.target.classList.contains("url")?(w=o(e.focusNode),void s()):null!=t.target.parentNode.classList&&t.target.parentNode.classList.contains("ui-inputs")?(w=o(e.focusNode),void s()):(e.isCollapsed===!0&&v===!1&&a(),e.isCollapsed===!1&&(w=o(e.focusNode),1==l(e.focusNode)&&(s(),r(),b.className="text-options active")),void(v=e.isCollapsed))}function r(){var t=window.getSelection(),e=t.getRangeAt(0),i=e.getBoundingClientRect();b.style.top=i.top-5+window.pageYOffset+"px",b.style.left=(i.left+i.right)/2+"px"}function s(){h(w,"B")?x.className="bold active":x.className="bold",h(w,"I")?B.className="italic active":B.className="italic",h(w,"A")?C.className="url useicons active":C.className="url useicons"}function a(){b.className="text-options fade",setTimeout(function(){"text-options fade"==b.className&&(b.className="text-options",b.style.top="-999px",b.style.left="-999px")},260)}function o(t){for(var e={};t.parentNode;)e[t.nodeName]=!0,t=t.parentNode,"A"===t.nodeName&&(e.url=t.getAttribute("href"));return e}function l(t){for(;t.parentNode;){if(void 0!==t.className&&t.className.indexOf("phrasable_on")>=0)return!0;t=t.parentNode}return!1}function h(t,e){return!!t[e]}function c(){document.execCommand("bold",!1)}function u(){document.execCommand("italic",!1)}function A(){"options"==y.className?(y.className="options url-mode",setTimeout(function(){var t=o(window.getSelection().focusNode);h(t,"A")?_.value=t.url:document.execCommand("createLink",!1,"/"),lastSelection=window.getSelection().getRangeAt(0),v=!1,_.focus()},100)):y.className="options"}function d(t){13===t.keyCode&&(t.preventDefault(),p(_.value),_.blur())}function f(){y.className="options",p(_.value),_.value="",w=o(window.getSelection().focusNode),s()}function p(t){g(),document.execCommand("unlink",!1),""!==t&&document.execCommand("createLink",!1,t)}function g(){window.getSelection().addRange(lastSelection)}var m,v,w,b,y,x,B,C,_;return{init:t}}();